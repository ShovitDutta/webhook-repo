<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>GitHub Events Monitor - Local</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
        <script>
            tailwind.config = {
                theme: {
                    extend: { colors: { github: { dark: "#24292e", gray: "#f6f8fa", border: "#e1e4e8", push: "#2cbe4e", pr: "#0366d6", merge: "#6f42c1", text: "#24292e", lighttext: "#6a737d" } } },
                },
            };
        </script>
        <style>
            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            .fade-in {
                animation: fadeIn 0.3s ease-in;
            }
            .github-event {
                border-left-width: 4px;
            }
            .push-event {
                border-left-color: #2cbe4e;
            }
            .pr-event {
                border-left-color: #0366d6;
            }
            .merge-event {
                border-left-color: #6f42c1;
            }
            .event-icon {
                width: 40px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 50%;
            }
            .icon-push {
                background-color: rgba(44, 190, 78, 0.1);
                color: #2cbe4e;
            }
            .icon-pr {
                background-color: rgba(3, 102, 214, 0.1);
                color: #0366d6;
            }
            .icon-merge {
                background-color: rgba(111, 66, 193, 0.1);
                color: #6f42c1;
            }
        </style>
    </head>
    <body class="bg-github-gray min-h-screen">
        <div class="max-w-4xl mx-auto py-8 px-4">
            <header class="bg-github-dark text-white rounded-t-xl shadow-md">
                <div class="py-6 px-6 text-center">
                    <h1 class="text-2xl md:text-3xl font-bold mb-2"><i class="fab fa-github mr-2"></i>GitHub Events Monitor</h1>
                    <p class="text-github-gray-light">Local Development Environment</p>
                </div>
            </header>
            <div class="bg-white border-b border-github-border p-6">
                <div class="flex items-start">
                    <div class="flex-shrink-0 bg-blue-100 p-3 rounded-full text-blue-600 mr-4"><i class="fas fa-info-circle text-lg"></i></div>
                    <div>
                        <h2 class="font-semibold text-lg mb-2">Setup Instructions</h2>
                        <p class="text-gray-600 mb-2">This UI automatically updates every 15 seconds. To test:</p>
                        <ol class="list-decimal pl-5 space-y-1">
                            <li>Set up a GitHub webhook for your repository pointing to <code class="bg-gray-100 px-2 py-1 rounded text-sm">http://localhost:5000/webhook</code></li>
                            <li>Use <strong class="font-semibold">ngrok</strong> to expose local port: <code class="bg-gray-100 px-2 py-1 rounded text-sm">ngrok http 5000</code></li>
                            <li>Perform actions (push, PR, merge) in your repository</li>
                        </ol>
                    </div>
                </div>
            </div>
            <div class="bg-white p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold">Recent GitHub Events</h2>
                    <div class="text-sm text-gray-500 flex items-center"><span id="last-updated">Last updated: Never</span> <span class="mx-2">â€¢</span> <span>Polling every 15s</span></div>
                </div>
                <div id="events-container" class="space-y-4">
                    <div id="no-events" class="text-center py-12 text-gray-500">
                        <i class="fas fa-inbox text-4xl mb-4 opacity-50"></i>
                        <p class="text-lg">No events recorded yet</p>
                        <p class="mt-2">Perform actions in your GitHub repository to see events here</p>
                    </div>
                </div>
            </div>
            <div class="bg-github-gray border-t border-github-border rounded-b-xl p-4 flex justify-between items-center text-sm">
                <div class="text-gray-600"><i class="fas fa-database mr-1"></i> MongoDB running on localhost:27017</div>
                <div class="text-gray-600"><i class="fas fa-server mr-1"></i> Flask server running on port 5000</div>
            </div>
            <div class="hidden">
                <div id="push-template" class="github-event push-event fade-in bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                    <div class="flex items-start">
                        <div class="event-icon icon-push mr-4"><i class="fas fa-arrow-up text-lg"></i></div>
                        <div class="flex-1">
                            <div class="font-medium text-gray-900"><span class="author">User</span> pushed to <span class="branch font-mono">branch</span></div>
                            <div class="text-sm text-gray-500 mt-1"><i class="far fa-clock mr-1"></i> <span class="timestamp">timestamp</span></div>
                        </div>
                    </div>
                </div>
                <div id="pr-template" class="github-event pr-event fade-in bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                    <div class="flex items-start">
                        <div class="event-icon icon-pr mr-4"><i class="fas fa-code-pull-request text-lg"></i></div>
                        <div class="flex-1">
                            <div class="font-medium text-gray-900">
                                <span class="author">User</span> submitted a pull request from <span class="from-branch font-mono">branch</span> to <span class="to-branch font-mono">branch</span>
                            </div>
                            <div class="text-sm text-gray-500 mt-1"><i class="far fa-clock mr-1"></i> <span class="timestamp">timestamp</span></div>
                        </div>
                    </div>
                </div>
                <div id="merge-template" class="github-event merge-event fade-in bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                    <div class="flex items-start">
                        <div class="event-icon icon-merge mr-4"><i class="fas fa-code-merge text-lg"></i></div>
                        <div class="flex-1">
                            <div class="font-medium text-gray-900">
                                <span class="author">User</span> merged branch <span class="from-branch font-mono">branch</span> to <span class="to-branch font-mono">branch</span>
                            </div>
                            <div class="text-sm text-gray-500 mt-1"><i class="far fa-clock mr-1"></i> <span class="timestamp">timestamp</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const eventsContainer = document.getElementById("events-container");
                const noEventsMessage = document.getElementById("no-events");
                const lastUpdatedEl = document.getElementById("last-updated");
                async function fetchEvents() {
                    try {
                        const response = await fetch("/events");
                        if (!response.ok) throw new Error("Network response was not ok");
                        const events = await response.json();
                        renderEvents(events);
                        updateLastUpdated();
                    } catch (error) {
                        console.error("Error fetching events:", error);
                        if (noEventsMessage) {
                            noEventsMessage.innerHTML = ` <div class="bg-red-50 border border-red-200 rounded-lg p-4 text-center"> <i class="fas fa-exclamation-triangle text-red-500 text-3xl mb-3"></i> <p class="text-red-700 font-medium">Error fetching events</p> <p class="text-red-600 mt-1">${error.message}</p> <p class="text-sm mt-2">Make sure the Flask server is running on port 5000</p> </div> `;
                        }
                    }
                }
                function renderEvents(events) {
                    if (!events || events.length === 0) {
                        if (noEventsMessage) noEventsMessage.style.display = "block";
                        eventsContainer.innerHTML = "";
                        return;
                    }
                    if (noEventsMessage) noEventsMessage.style.display = "none";
                    eventsContainer.innerHTML = "";
                    events.forEach((event) => {
                        let templateId, eventClass;
                        switch (event.action) {
                            case "PUSH":
                                templateId = "push-template";
                                eventClass = "push-event";
                                break;
                            case "PULL_REQUEST":
                                templateId = "pr-template";
                                eventClass = "pr-event";
                                break;
                            case "MERGE":
                                templateId = "merge-template";
                                eventClass = "merge-event";
                                break;
                            default:
                                return;
                        }
                        const template = document.getElementById(templateId);
                        if (!template) return;
                        const eventElement = template.cloneNode(true);
                        eventElement.id = "";
                        eventElement.classList.add("github-event", eventClass, "fade-in");
                        if (event.action === "PUSH") {
                            eventElement.querySelector(".author").textContent = event.author;
                            eventElement.querySelector(".branch").textContent = event.to_branch;
                        } else {
                            eventElement.querySelector(".author").textContent = event.author;
                            eventElement.querySelector(".from-branch").textContent = event.from_branch;
                            eventElement.querySelector(".to-branch").textContent = event.to_branch;
                        }
                        eventElement.querySelector(".timestamp").textContent = event.timestamp;
                        eventsContainer.appendChild(eventElement);
                    });
                }
                function updateLastUpdated() {
                    const now = new Date();
                    const timeString = now.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
                    lastUpdatedEl.textContent = `Last updated: ${timeString}`;
                }
                fetchEvents();
                setInterval(fetchEvents, 15000);
                simulateDemoEvents();
                function simulateDemoEvents() {
                    setTimeout(() => {
                        if (document.querySelector(".github-event") === null) {
                            createDemoEvent("push-template", { author: "devuser", to_branch: "main", timestamp: "3rd July 2023 - 10:15 AM UTC" });
                            setTimeout(() => {
                                createDemoEvent("pr-template", { author: "coder42", from_branch: "feature-login", to_branch: "develop", timestamp: "3rd July 2023 - 09:45 AM UTC" });
                                setTimeout(() => {
                                    createDemoEvent("merge-template", { author: "techlead", from_branch: "release-v1.2", to_branch: "main", timestamp: "2nd July 2023 - 02:30 PM UTC" });
                                }, 1000);
                            }, 1000);
                        }
                    }, 1500);
                }
                function createDemoEvent(templateId, data) {
                    const template = document.getElementById(templateId);
                    if (!template) return;
                    const eventElement = template.cloneNode(true);
                    eventElement.id = "";
                    eventElement.style.display = "block";
                    if (templateId === "push-template") {
                        eventElement.querySelector(".author").textContent = data.author;
                        eventElement.querySelector(".branch").textContent = data.to_branch;
                    } else {
                        eventElement.querySelector(".author").textContent = data.author;
                        eventElement.querySelector(".from-branch").textContent = data.from_branch;
                        eventElement.querySelector(".to-branch").textContent = data.to_branch;
                    }
                    eventElement.querySelector(".timestamp").textContent = data.timestamp;
                    if (noEventsMessage) noEventsMessage.style.display = "none";
                    eventsContainer.prepend(eventElement);
                }
            });
        </script>
    </body>
</html>
